"use strict";(self["webpackChunkvue_cnode"]=self["webpackChunkvue_cnode"]||[]).push([[533],{1533:function(t,s,e){e.r(s),e.d(s,{default:function(){return m}});var c=function(){var t=this,s=t._self._c;return t.topic?s("div",{staticClass:"topic"},[s("base-panel",[s("template",{slot:"panel-content"},[s("div",{staticClass:"topic-header"},[s("div",{staticClass:"topic-header-top"},[t.topic.top||t.topic.good?s("el-tag",{staticClass:"tag",attrs:{size:"mini",effect:"dark",type:"success"}},[t._v(t._s(t.topic.top?"置顶":"精华"))]):t._e(),s("h3",[t._v(t._s(t.topic.title))]),t.accesstoken?s("el-button",{attrs:{type:"success"},on:{click:t.collect}},[t._v(" "+t._s(t.topic.is_collect?"取消收藏":"收藏")+" ")]):t._e()],1),s("p",[s("span",{staticClass:"icon-dian iconfont disc"}),s("span",{staticClass:"spanText"},[t._v("发布于"+t._s(t._f("fromNow")(t.topic.create_at)))]),s("span",{staticClass:"icon-dian iconfont disc"}),s("span",{staticClass:"spanText"},[t._v("作者"+t._s(t.topic.author.loginname))]),s("span",{staticClass:"icon-dian iconfont disc"}),s("span",{staticClass:"spanText"},[t._v(t._s(t.topic.visit_count)+"次浏览")]),s("span",{staticClass:"icon-dian iconfont disc"}),s("span",{staticClass:"spanText"},[t._v("来自"+t._s(t._f("tabTextTransform")(t.topic.tab)))])])]),s("div",{staticClass:"topic-content",domProps:{innerHTML:t._s(t.topic.content)}})])],2),t.topic.reply_count>0?s("base-panel",{staticClass:"comment-box"},[s("template",{slot:"panel-head"},[s("div",{staticClass:"comment-head"},[s("span",[t._v(t._s(t.topic.reply_count)+"回复")])])]),s("template",{slot:"panel-content"},[s("div",{staticClass:"comment-list"},t._l(t.topic.replies,(function(e,c){return s("div",{key:e.id,class:["comment-item",{active:t.commentLikeMost.includes(e.id)}]},[s("router-link",{attrs:{to:`/user/${e.author.loginname}`}},[s("img",{attrs:{src:e.author.avatar_url,alt:"",width:"40px"}})]),s("div",{staticClass:"comment-content"},[s("span",{staticClass:"info"},[s("span",[t._v(" "+t._s(e.author.loginname)+"   "+t._s(c+1)+"楼 "+t._s(t._f("fromNow")(e.create_at))+" "),s("span",{staticClass:"icon-dian iconfont disc"}),t._v("    ")]),t.accesstoken||e.ups.length?s("span",[t._v(t._s(e.ups.length)+" "),s("span",{staticClass:"icon-dianzan iconfont",on:{click:function(s){return t.like(e)}}})]):t._e()]),s("span",{staticClass:"text",domProps:{innerHTML:t._s(e.content)}})])],1)})),0)])],2):t._e(),t.accesstoken?s("base-panel",[s("template",{slot:"panel-head"},[t._v(" 添加回复 ")]),s("template",{slot:"panel-content"},[s("div",[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.commentText,expression:"commentText"}],staticClass:"qinlunhufu",domProps:{value:t.commentText},on:{input:function(s){s.target.composing||(t.commentText=s.target.value)}}}),s("el-button",{attrs:{type:"primary"},on:{click:t.reply}},[t._v("主要按钮")])],1)])],2):t._e()],1):t._e()},i=[],n=(e(7658),e(6797)),a=e.n(n),o=e(2301),l=e(3150),p={components:{basePanel:o.Z},props:["id"],data(){return{topic:null,accesstoken:"",commentText:""}},async created(){const t=sessionStorage.getItem("accesstoken");t&&(this.accesstoken=t);const s=await(0,l.Ht)(this.id,t||null);this.topic=s.data},computed:{commentLikeMost(){if(0===this.topic.replies.length)return[];const t=this.topic.replies.slice(0).sort(((t,s)=>s.ups.length-t.ups.length)),s=[],e=t[0].ups.length;if(e>2){const c=t.filter((t=>t.ups.length===e));c.forEach((t=>{s.push(t.id)}));const i=t[c.length].ups.length;if(i>2){const e=t.filter((t=>t.ups.length===i));e.forEach((t=>{s.push(t.id)}))}return s}return[]}},methods:{async collect(){this.topic.is_collect?(await(0,l.uk)(this.accesstoken,this.topic.id),this.topic.is_collect=!1):(await(0,l.dA)(this.accesstoken,this.topic.id),this.topic.is_collect=!0)},async like(t){const s=this.accesstoken;if(s){var e=await(0,l.vo)(t.id,s);console.log(e);const c=JSON.parse(sessionStorage.getItem("userInfo")).id;"up"===e.action?(t.is_uped=!0,t.ups.push(c)):(t.is_uped=!1,t.ups=t.ups.filter((t=>t!==c)))}},async reply(){const{topic:t,commentText:s,accesstoken:e}=this;await(0,l.ts)(t.id,e,s);const c=await(0,l.Ht)(this.id,e);this.topic=c.data,this.commentText="";const i=this.topic.replies[this.topic.replies.length-1].create_at,n=a()(i).format("MMMM Do YYYY, h:mm:ss a");console.log(n),console.log(i)}}},r=p,u=e(1001),d=(0,u.Z)(r,c,i,!1,null,"7bc1f4c7",null),m=d.exports}}]);
//# sourceMappingURL=533.554cd1af.js.map